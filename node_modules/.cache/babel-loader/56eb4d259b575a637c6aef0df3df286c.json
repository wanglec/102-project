{"ast":null,"code":"import { WebGLRenderer, Scene, PerspectiveCamera, Raycaster, TextureLoader, Vector2, Vector3, Box3, Color, Mesh, SphereGeometry, MeshBasicMaterial, BackSide, EventDispatcher, MOUSE, Quaternion, Spherical, Clock } from 'three';\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { FlyControls } from 'three/examples/jsm/controls/FlyControls.js';\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\nimport { parseToRgb, opacify } from 'polished';\nimport TWEEN from '@tweenjs/tween.js';\nimport accessorFn from 'accessor-fn';\nimport Kapsule from 'kapsule';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".scene-nav-info {\\n  bottom: 5px;\\n  width: 100%;\\n  text-align: center;\\n  color: slategrey;\\n  opacity: 0.7;\\n  font-size: 10px;\\n}\\n\\n.scene-tooltip {\\n  color: lavender;\\n  font-size: 15px;\\n}\\n\\n.scene-nav-info, .scene-tooltip {\\n  position: absolute;\\n  font-family: sans-serif;\\n  pointer-events: none;\\n}\\n\\n.scene-container canvas:focus {\\n  outline: none;\\n}\";\nstyleInject(css_248z);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  WebGLRenderer: WebGLRenderer,\n  Scene: Scene,\n  PerspectiveCamera: PerspectiveCamera,\n  Raycaster: Raycaster,\n  TextureLoader: TextureLoader,\n  Vector2: Vector2,\n  Vector3: Vector3,\n  Box3: Box3,\n  Color: Color,\n  Mesh: Mesh,\n  SphereGeometry: SphereGeometry,\n  MeshBasicMaterial: MeshBasicMaterial,\n  BackSide: BackSide,\n  EventDispatcher: EventDispatcher,\n  MOUSE: MOUSE,\n  Quaternion: Quaternion,\n  Spherical: Spherical,\n  Clock: Clock\n};\nvar threeRenderObjects = Kapsule({\n  props: {\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(width, state, prevWidth) {\n        isNaN(width) && (state.width = prevWidth);\n      }\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(height, state, prevHeight) {\n        isNaN(height) && (state.height = prevHeight);\n      }\n    },\n    backgroundColor: {\n      \"default\": '#000011'\n    },\n    backgroundImageUrl: {},\n    onBackgroundImageLoaded: {},\n    showNavInfo: {\n      \"default\": true\n    },\n    skyRadius: {\n      \"default\": 50000\n    },\n    objects: {\n      \"default\": []\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        // Reset hover state\n        state.hoverObj = null;\n        if (state.toolTipElem) state.toolTipElem.innerHTML = '';\n      },\n      triggerUpdate: false\n    },\n    lineHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    hoverOrderComparator: {\n      \"default\": function _default() {\n        return -1;\n      },\n      triggerUpdate: false\n    },\n    // keep existing order by default\n    hoverFilter: {\n      \"default\": function _default() {\n        return true;\n      },\n      triggerUpdate: false\n    },\n    // exclude objects from interaction\n    tooltipContent: {\n      triggerUpdate: false\n    },\n    hoverDuringDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    clickAfterDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    onHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRightClick: {\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    tick: function tick(state) {\n      if (state.initialised) {\n        state.controls.update && state.controls.update(state.clock.getDelta()); // timedelta is required for fly controls\n\n        state.postProcessingComposer ? state.postProcessingComposer.render() // if using postprocessing, switch the output to it\n        : state.renderer.render(state.scene, state.camera);\n        state.extraRenderers.forEach(function (r) {\n          return r.render(state.scene, state.camera);\n        });\n\n        if (state.enablePointerInteraction) {\n          // Update tooltip and trigger onHover events\n          var topObject = null;\n\n          if (state.hoverDuringDrag || !state.isPointerDragging) {\n            var intersects = this.intersectingObjects(state.pointerPos.x, state.pointerPos.y).filter(function (d) {\n              return state.hoverFilter(d.object);\n            }).sort(function (a, b) {\n              return state.hoverOrderComparator(a.object, b.object);\n            });\n            var topIntersect = intersects.length ? intersects[0] : null;\n            topObject = topIntersect ? topIntersect.object : null;\n            state.intersectionPoint = topIntersect ? topIntersect.point : null;\n          }\n\n          if (topObject !== state.hoverObj) {\n            state.onHover(topObject, state.hoverObj);\n            state.toolTipElem.innerHTML = topObject ? accessorFn(state.tooltipContent)(topObject) || '' : '';\n            state.hoverObj = topObject;\n          }\n        }\n\n        TWEEN.update(); // update camera animation tweens\n      }\n\n      return this;\n    },\n    getPointerPos: function getPointerPos(state) {\n      var _state$pointerPos = state.pointerPos,\n          x = _state$pointerPos.x,\n          y = _state$pointerPos.y;\n      return {\n        x: x,\n        y: y\n      };\n    },\n    cameraPosition: function cameraPosition(state, position, lookAt, transitionDuration) {\n      var camera = state.camera; // Setter\n\n      if (position && state.initialised) {\n        var finalPos = position;\n        var finalLookAt = lookAt || {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n\n        if (!transitionDuration) {\n          // no animation\n          setCameraPos(finalPos);\n          setLookAt(finalLookAt);\n        } else {\n          var camPos = Object.assign({}, camera.position);\n          var camLookAt = getLookAt();\n          new TWEEN.Tween(camPos).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCameraPos).start(); // Face direction in 1/3rd of time\n\n          new TWEEN.Tween(camLookAt).to(finalLookAt, transitionDuration / 3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setLookAt).start();\n        }\n\n        return this;\n      } // Getter\n\n\n      return Object.assign({}, camera.position, {\n        lookAt: getLookAt()\n      }); //\n\n      function setCameraPos(pos) {\n        var x = pos.x,\n            y = pos.y,\n            z = pos.z;\n        if (x !== undefined) camera.position.x = x;\n        if (y !== undefined) camera.position.y = y;\n        if (z !== undefined) camera.position.z = z;\n      }\n\n      function setLookAt(lookAt) {\n        state.controls.target = new three.Vector3(lookAt.x, lookAt.y, lookAt.z);\n      }\n\n      function getLookAt() {\n        return Object.assign(new three.Vector3(0, 0, -1000).applyQuaternion(camera.quaternion).add(camera.position));\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      return this.fitToBbox(this.getBbox.apply(this, bboxArgs), transitionDuration, padding);\n    },\n    fitToBbox: function fitToBbox(state, bbox) {\n      var transitionDuration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var padding = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10; // based on https://discourse.threejs.org/t/camera-zoom-to-fit-object/936/24\n\n      var camera = state.camera;\n\n      if (bbox) {\n        var center = new three.Vector3(0, 0, 0); // reset camera aim to center\n\n        var maxBoxSide = Math.max.apply(Math, _toConsumableArray(Object.entries(bbox).map(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              coordType = _ref2[0],\n              coords = _ref2[1];\n\n          return Math.max.apply(Math, _toConsumableArray(coords.map(function (c) {\n            return Math.abs(center[coordType] - c);\n          })));\n        }))) * 2; // find distance that fits whole bbox within padded fov\n\n        var paddedFov = (1 - padding * 2 / state.height) * camera.fov;\n        var fitHeightDistance = maxBoxSide / Math.atan(paddedFov * Math.PI / 180);\n        var fitWidthDistance = fitHeightDistance / camera.aspect;\n        var distance = Math.max(fitHeightDistance, fitWidthDistance);\n\n        if (distance > 0) {\n          var newCameraPosition = center.clone().sub(camera.position).normalize().multiplyScalar(-distance);\n          this.cameraPosition(newCameraPosition, center, transitionDuration);\n        }\n      }\n\n      return this;\n    },\n    getBbox: function getBbox(state) {\n      var objFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var box = new three.Box3(new three.Vector3(0, 0, 0), new three.Vector3(0, 0, 0));\n      var objs = state.objects.filter(objFilter);\n      if (!objs.length) return null;\n      objs.forEach(function (obj) {\n        return box.expandByObject(obj);\n      }); // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [box.min[c], box.max[c]]);\n      })));\n    },\n    getScreenCoords: function getScreenCoords(state, x, y, z) {\n      var vec = new three.Vector3(x, y, z);\n      vec.project(this.camera()); // project to the camera plane\n\n      return {\n        // align relative pos to canvas dimensions\n        x: (vec.x + 1) * state.width / 2,\n        y: -(vec.y - 1) * state.height / 2\n      };\n    },\n    getSceneCoords: function getSceneCoords(state, screenX, screenY) {\n      var distance = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var relCoords = new three.Vector2(screenX / state.width * 2 - 1, -(screenY / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.setFromCamera(relCoords, state.camera);\n      return Object.assign({}, raycaster.ray.at(distance, new three.Vector3()));\n    },\n    intersectingObjects: function intersectingObjects(state, x, y) {\n      var relCoords = new three.Vector2(x / state.width * 2 - 1, -(y / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.params.Line.threshold = state.lineHoverPrecision; // set linePrecision\n\n      raycaster.setFromCamera(relCoords, state.camera);\n      return raycaster.intersectObjects(state.objects, true);\n    },\n    renderer: function renderer(state) {\n      return state.renderer;\n    },\n    scene: function scene(state) {\n      return state.scene;\n    },\n    camera: function camera(state) {\n      return state.camera;\n    },\n    postProcessingComposer: function postProcessingComposer(state) {\n      return state.postProcessingComposer;\n    },\n    controls: function controls(state) {\n      return state.controls;\n    },\n    tbControls: function tbControls(state) {\n      return state.controls;\n    } // to be deprecated\n\n  },\n  stateInit: function stateInit() {\n    return {\n      scene: new three.Scene(),\n      camera: new three.PerspectiveCamera(),\n      clock: new three.Clock()\n    };\n  },\n  init: function init(domNode, state) {\n    var _ref4 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n        _ref4$controlType = _ref4.controlType,\n        controlType = _ref4$controlType === void 0 ? 'trackball' : _ref4$controlType,\n        _ref4$rendererConfig = _ref4.rendererConfig,\n        rendererConfig = _ref4$rendererConfig === void 0 ? {} : _ref4$rendererConfig,\n        _ref4$extraRenderers = _ref4.extraRenderers,\n        extraRenderers = _ref4$extraRenderers === void 0 ? [] : _ref4$extraRenderers,\n        _ref4$waitForLoadComp = _ref4.waitForLoadComplete,\n        waitForLoadComplete = _ref4$waitForLoadComp === void 0 ? true : _ref4$waitForLoadComp; // Wipe DOM\n\n\n    domNode.innerHTML = ''; // Add relative container\n\n    domNode.appendChild(state.container = document.createElement('div'));\n    state.container.className = 'scene-container';\n    state.container.style.position = 'relative'; // Add nav info section\n\n    state.container.appendChild(state.navInfo = document.createElement('div'));\n    state.navInfo.className = 'scene-nav-info';\n    state.navInfo.textContent = {\n      orbit: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      trackball: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      fly: 'WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw'\n    }[controlType] || '';\n    state.navInfo.style.display = state.showNavInfo ? null : 'none'; // Setup tooltip\n\n    state.toolTipElem = document.createElement('div');\n    state.toolTipElem.classList.add('scene-tooltip');\n    state.container.appendChild(state.toolTipElem); // Capture pointer coords on move or touchstart\n\n    state.pointerPos = new three.Vector2();\n    state.pointerPos.x = -2; // Initialize off canvas\n\n    state.pointerPos.y = -2;\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return state.container.addEventListener(evType, function (ev) {\n        // track click state\n        evType === 'pointerdown' && (state.isPointerPressed = true); // detect point drag\n\n        !state.isPointerDragging && ev.type === 'pointermove' && (ev.pressure > 0 || state.isPointerPressed) // ev.pressure always 0 on Safari, so we used the isPointerPressed tracker\n        && (ev.pointerType !== 'touch' || ev.movementX === undefined || [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > 1;\n        })) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true);\n\n        if (state.enablePointerInteraction) {\n          // update the pointer pos\n          var offset = getOffset(state.container);\n          state.pointerPos.x = ev.pageX - offset.left;\n          state.pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n          state.toolTipElem.style.top = \"\".concat(state.pointerPos.y, \"px\");\n          state.toolTipElem.style.left = \"\".concat(state.pointerPos.x, \"px\");\n          state.toolTipElem.style.transform = \"translate(-\".concat(state.pointerPos.x / state.width * 100, \"%, 21px)\"); // adjust horizontal position to not exceed canvas boundaries\n        }\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    }); // Handle click events on objs\n\n    state.container.addEventListener('pointerup', function (ev) {\n      state.isPointerPressed = false;\n\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        if (!state.clickAfterDrag) return; // don't trigger onClick after pointer drag (camera motion via controls)\n      }\n\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // left-click\n          state.onClick(state.hoverObj || null, ev, state.intersectionPoint); // trigger background clicks with null\n        }\n\n        if (ev.button === 2 && state.onRightClick) {\n          // right-click\n          state.onRightClick(state.hoverObj || null, ev, state.intersectionPoint);\n        }\n      });\n    }, {\n      passive: true,\n      capture: true\n    }); // use capture phase to prevent propagation blocking from controls (specifically for fly)\n\n    state.container.addEventListener('contextmenu', function (ev) {\n      if (state.onRightClick) ev.preventDefault(); // prevent default contextmenu behavior and allow pointerup to fire instead\n    }); // Setup renderer, camera and controls\n\n    state.renderer = new three.WebGLRenderer(Object.assign({\n      antialias: true,\n      alpha: true\n    }, rendererConfig));\n    state.renderer.setPixelRatio(Math.min(2, window.devicePixelRatio)); // clamp device pixel ratio\n\n    state.container.appendChild(state.renderer.domElement); // Setup extra renderers\n\n    state.extraRenderers = extraRenderers;\n    state.extraRenderers.forEach(function (r) {\n      // overlay them on top of main renderer\n      r.domElement.style.position = 'absolute';\n      r.domElement.style.top = '0px';\n      r.domElement.style.pointerEvents = 'none';\n      state.container.appendChild(r.domElement);\n    }); // configure post-processing composer\n\n    state.postProcessingComposer = new EffectComposer(state.renderer);\n    state.postProcessingComposer.addPass(new RenderPass(state.scene, state.camera)); // render scene as first pass\n    // configure controls\n\n    state.controls = new {\n      trackball: TrackballControls,\n      orbit: OrbitControls,\n      fly: FlyControls\n    }[controlType](state.camera, state.renderer.domElement);\n\n    if (controlType === 'fly') {\n      state.controls.movementSpeed = 300;\n      state.controls.rollSpeed = Math.PI / 6;\n      state.controls.dragToLook = true;\n    }\n\n    if (controlType === 'trackball' || controlType === 'orbit') {\n      state.controls.minDistance = 0.1;\n      state.controls.maxDistance = state.skyRadius;\n      state.controls.addEventListener('start', function () {\n        state.isPointerPressed = true; // trackball controls blocks pointerdown events, so we have to track it (also) here\n\n        state.controlsEngaged = true;\n      });\n      state.controls.addEventListener('change', function () {\n        if (state.controlsEngaged) {\n          state.controlsDragging = true;\n        }\n      });\n      state.controls.addEventListener('end', function () {\n        state.controlsEngaged = false;\n        state.controlsDragging = false;\n      });\n    }\n\n    [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n      return r.setSize(state.width, state.height);\n    });\n    state.camera.aspect = state.width / state.height;\n    state.camera.updateProjectionMatrix();\n    state.camera.position.z = 1000; // add sky\n\n    state.scene.add(state.skysphere = new three.Mesh());\n    state.skysphere.visible = false;\n    state.loadComplete = state.scene.visible = !waitForLoadComplete;\n    window.scene = state.scene;\n  },\n  update: function update(state, changedProps) {\n    // resize canvas\n    if (state.width && state.height && (changedProps.hasOwnProperty('width') || changedProps.hasOwnProperty('height'))) {\n      state.container.style.width = state.width;\n      state.container.style.height = state.height;\n      [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n        return r.setSize(state.width, state.height);\n      });\n      state.camera.aspect = state.width / state.height;\n      state.camera.updateProjectionMatrix();\n    }\n\n    if (changedProps.hasOwnProperty('skyRadius') && state.skyRadius) {\n      state.controls.hasOwnProperty('maxDistance') && changedProps.skyRadius && (state.controls.maxDistance = state.skyRadius);\n      state.camera.far = state.skyRadius * 2.5;\n      state.camera.updateProjectionMatrix();\n      state.skysphere.geometry = new three.SphereGeometry(state.skyRadius);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundColor')) {\n      var alpha = parseToRgb(state.backgroundColor).alpha;\n      if (alpha === undefined) alpha = 1;\n      state.renderer.setClearColor(new three.Color(opacify(1, state.backgroundColor)), alpha);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundImageUrl')) {\n      if (!state.backgroundImageUrl) {\n        state.skysphere.visible = false;\n        state.skysphere.material.map = null;\n        !state.loadComplete && finishLoad();\n      } else {\n        new three.TextureLoader().load(state.backgroundImageUrl, function (texture) {\n          state.skysphere.material = new three.MeshBasicMaterial({\n            map: texture,\n            side: three.BackSide\n          });\n          state.skysphere.visible = true; // triggered when background image finishes loading (asynchronously to allow 1 frame to load texture)\n\n          state.onBackgroundImageLoaded && setTimeout(state.onBackgroundImageLoaded);\n          !state.loadComplete && finishLoad();\n        });\n      }\n    }\n\n    changedProps.hasOwnProperty('showNavInfo') && (state.navInfo.style.display = state.showNavInfo ? null : 'none');\n\n    if (changedProps.hasOwnProperty('objects')) {\n      (changedProps.objects || []).forEach(function (obj) {\n        return state.scene.remove(obj);\n      }); // Clear the place\n\n      state.objects.forEach(function (obj) {\n        return state.scene.add(obj);\n      }); // Add to scene\n    } //\n\n\n    function finishLoad() {\n      state.loadComplete = state.scene.visible = true;\n    }\n  }\n});\nexport default threeRenderObjects;","map":{"version":3,"sources":["/Users/lechuanwang/Documents/2021 spring/dsc106/project/dsc102/102-project/node_modules/three-render-objects/dist/three-render-objects.module.js"],"names":["WebGLRenderer","Scene","PerspectiveCamera","Raycaster","TextureLoader","Vector2","Vector3","Box3","Color","Mesh","SphereGeometry","MeshBasicMaterial","BackSide","EventDispatcher","MOUSE","Quaternion","Spherical","Clock","TrackballControls","OrbitControls","FlyControls","EffectComposer","RenderPass","parseToRgb","opacify","TWEEN","accessorFn","Kapsule","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","css_248z","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","Symbol","iterator","from","_i","_arr","_n","_d","_s","_e","call","next","done","push","length","err","o","minLen","n","prototype","toString","slice","constructor","name","test","len","arr2","TypeError","three","window","THREE","threeRenderObjects","props","width","innerWidth","onChange","state","prevWidth","isNaN","height","innerHeight","prevHeight","backgroundColor","backgroundImageUrl","onBackgroundImageLoaded","showNavInfo","skyRadius","objects","enablePointerInteraction","_","hoverObj","toolTipElem","innerHTML","triggerUpdate","lineHoverPrecision","hoverOrderComparator","_default","hoverFilter","tooltipContent","hoverDuringDrag","clickAfterDrag","onHover","onClick","onRightClick","methods","tick","initialised","controls","update","clock","getDelta","postProcessingComposer","render","renderer","scene","camera","extraRenderers","forEach","r","topObject","isPointerDragging","intersects","intersectingObjects","pointerPos","x","y","filter","d","object","sort","a","b","topIntersect","intersectionPoint","point","getPointerPos","_state$pointerPos","cameraPosition","position","lookAt","transitionDuration","finalPos","finalLookAt","z","setCameraPos","setLookAt","camPos","assign","camLookAt","getLookAt","Tween","to","easing","Easing","Quadratic","Out","onUpdate","start","pos","undefined","target","applyQuaternion","quaternion","add","zoomToFit","arguments","padding","_len","bboxArgs","_key","fitToBbox","getBbox","apply","bbox","center","maxBoxSide","Math","max","entries","map","_ref","_ref2","coordType","coords","c","abs","paddedFov","fov","fitHeightDistance","atan","PI","fitWidthDistance","aspect","distance","newCameraPosition","clone","sub","normalize","multiplyScalar","objFilter","box","objs","expandByObject","min","getScreenCoords","vec","project","getSceneCoords","screenX","screenY","relCoords","raycaster","setFromCamera","ray","at","params","Line","threshold","intersectObjects","tbControls","stateInit","init","domNode","_ref4","_ref4$controlType","controlType","_ref4$rendererConfig","rendererConfig","_ref4$extraRenderers","_ref4$waitForLoadComp","waitForLoadComplete","container","className","navInfo","textContent","orbit","trackball","fly","display","classList","evType","addEventListener","ev","isPointerPressed","pressure","pointerType","movementX","movementY","some","m","offset","getOffset","pageX","left","pageY","top","concat","transform","el","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","scrollTop","pageYOffset","passive","requestAnimationFrame","button","capture","preventDefault","antialias","alpha","setPixelRatio","devicePixelRatio","domElement","pointerEvents","addPass","movementSpeed","rollSpeed","dragToLook","minDistance","maxDistance","controlsEngaged","controlsDragging","setSize","updateProjectionMatrix","skysphere","visible","loadComplete","changedProps","hasOwnProperty","far","geometry","setClearColor","material","finishLoad","load","texture","side","setTimeout","remove"],"mappings":"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","sourcesContent":["import { WebGLRenderer, Scene, PerspectiveCamera, Raycaster, TextureLoader, Vector2, Vector3, Box3, Color, Mesh, SphereGeometry, MeshBasicMaterial, BackSide, EventDispatcher, MOUSE, Quaternion, Spherical, Clock } from 'three';\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { FlyControls } from 'three/examples/jsm/controls/FlyControls.js';\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\nimport { parseToRgb, opacify } from 'polished';\nimport TWEEN from '@tweenjs/tween.js';\nimport accessorFn from 'accessor-fn';\nimport Kapsule from 'kapsule';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".scene-nav-info {\\n  bottom: 5px;\\n  width: 100%;\\n  text-align: center;\\n  color: slategrey;\\n  opacity: 0.7;\\n  font-size: 10px;\\n}\\n\\n.scene-tooltip {\\n  color: lavender;\\n  font-size: 15px;\\n}\\n\\n.scene-nav-info, .scene-tooltip {\\n  position: absolute;\\n  font-family: sans-serif;\\n  pointer-events: none;\\n}\\n\\n.scene-container canvas:focus {\\n  outline: none;\\n}\";\nstyleInject(css_248z);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  WebGLRenderer: WebGLRenderer,\n  Scene: Scene,\n  PerspectiveCamera: PerspectiveCamera,\n  Raycaster: Raycaster,\n  TextureLoader: TextureLoader,\n  Vector2: Vector2,\n  Vector3: Vector3,\n  Box3: Box3,\n  Color: Color,\n  Mesh: Mesh,\n  SphereGeometry: SphereGeometry,\n  MeshBasicMaterial: MeshBasicMaterial,\n  BackSide: BackSide,\n  EventDispatcher: EventDispatcher,\n  MOUSE: MOUSE,\n  Quaternion: Quaternion,\n  Spherical: Spherical,\n  Clock: Clock\n};\nvar threeRenderObjects = Kapsule({\n  props: {\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(width, state, prevWidth) {\n        isNaN(width) && (state.width = prevWidth);\n      }\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(height, state, prevHeight) {\n        isNaN(height) && (state.height = prevHeight);\n      }\n    },\n    backgroundColor: {\n      \"default\": '#000011'\n    },\n    backgroundImageUrl: {},\n    onBackgroundImageLoaded: {},\n    showNavInfo: {\n      \"default\": true\n    },\n    skyRadius: {\n      \"default\": 50000\n    },\n    objects: {\n      \"default\": []\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        // Reset hover state\n        state.hoverObj = null;\n        if (state.toolTipElem) state.toolTipElem.innerHTML = '';\n      },\n      triggerUpdate: false\n    },\n    lineHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    hoverOrderComparator: {\n      \"default\": function _default() {\n        return -1;\n      },\n      triggerUpdate: false\n    },\n    // keep existing order by default\n    hoverFilter: {\n      \"default\": function _default() {\n        return true;\n      },\n      triggerUpdate: false\n    },\n    // exclude objects from interaction\n    tooltipContent: {\n      triggerUpdate: false\n    },\n    hoverDuringDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    clickAfterDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    onHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRightClick: {\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    tick: function tick(state) {\n      if (state.initialised) {\n        state.controls.update && state.controls.update(state.clock.getDelta()); // timedelta is required for fly controls\n\n        state.postProcessingComposer ? state.postProcessingComposer.render() // if using postprocessing, switch the output to it\n        : state.renderer.render(state.scene, state.camera);\n        state.extraRenderers.forEach(function (r) {\n          return r.render(state.scene, state.camera);\n        });\n\n        if (state.enablePointerInteraction) {\n          // Update tooltip and trigger onHover events\n          var topObject = null;\n\n          if (state.hoverDuringDrag || !state.isPointerDragging) {\n            var intersects = this.intersectingObjects(state.pointerPos.x, state.pointerPos.y).filter(function (d) {\n              return state.hoverFilter(d.object);\n            }).sort(function (a, b) {\n              return state.hoverOrderComparator(a.object, b.object);\n            });\n            var topIntersect = intersects.length ? intersects[0] : null;\n            topObject = topIntersect ? topIntersect.object : null;\n            state.intersectionPoint = topIntersect ? topIntersect.point : null;\n          }\n\n          if (topObject !== state.hoverObj) {\n            state.onHover(topObject, state.hoverObj);\n            state.toolTipElem.innerHTML = topObject ? accessorFn(state.tooltipContent)(topObject) || '' : '';\n            state.hoverObj = topObject;\n          }\n        }\n\n        TWEEN.update(); // update camera animation tweens\n      }\n\n      return this;\n    },\n    getPointerPos: function getPointerPos(state) {\n      var _state$pointerPos = state.pointerPos,\n          x = _state$pointerPos.x,\n          y = _state$pointerPos.y;\n      return {\n        x: x,\n        y: y\n      };\n    },\n    cameraPosition: function cameraPosition(state, position, lookAt, transitionDuration) {\n      var camera = state.camera; // Setter\n\n      if (position && state.initialised) {\n        var finalPos = position;\n        var finalLookAt = lookAt || {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n\n        if (!transitionDuration) {\n          // no animation\n          setCameraPos(finalPos);\n          setLookAt(finalLookAt);\n        } else {\n          var camPos = Object.assign({}, camera.position);\n          var camLookAt = getLookAt();\n          new TWEEN.Tween(camPos).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCameraPos).start(); // Face direction in 1/3rd of time\n\n          new TWEEN.Tween(camLookAt).to(finalLookAt, transitionDuration / 3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setLookAt).start();\n        }\n\n        return this;\n      } // Getter\n\n\n      return Object.assign({}, camera.position, {\n        lookAt: getLookAt()\n      }); //\n\n      function setCameraPos(pos) {\n        var x = pos.x,\n            y = pos.y,\n            z = pos.z;\n        if (x !== undefined) camera.position.x = x;\n        if (y !== undefined) camera.position.y = y;\n        if (z !== undefined) camera.position.z = z;\n      }\n\n      function setLookAt(lookAt) {\n        state.controls.target = new three.Vector3(lookAt.x, lookAt.y, lookAt.z);\n      }\n\n      function getLookAt() {\n        return Object.assign(new three.Vector3(0, 0, -1000).applyQuaternion(camera.quaternion).add(camera.position));\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      return this.fitToBbox(this.getBbox.apply(this, bboxArgs), transitionDuration, padding);\n    },\n    fitToBbox: function fitToBbox(state, bbox) {\n      var transitionDuration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var padding = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10;\n      // based on https://discourse.threejs.org/t/camera-zoom-to-fit-object/936/24\n      var camera = state.camera;\n\n      if (bbox) {\n        var center = new three.Vector3(0, 0, 0); // reset camera aim to center\n\n        var maxBoxSide = Math.max.apply(Math, _toConsumableArray(Object.entries(bbox).map(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              coordType = _ref2[0],\n              coords = _ref2[1];\n\n          return Math.max.apply(Math, _toConsumableArray(coords.map(function (c) {\n            return Math.abs(center[coordType] - c);\n          })));\n        }))) * 2; // find distance that fits whole bbox within padded fov\n\n        var paddedFov = (1 - padding * 2 / state.height) * camera.fov;\n        var fitHeightDistance = maxBoxSide / Math.atan(paddedFov * Math.PI / 180);\n        var fitWidthDistance = fitHeightDistance / camera.aspect;\n        var distance = Math.max(fitHeightDistance, fitWidthDistance);\n\n        if (distance > 0) {\n          var newCameraPosition = center.clone().sub(camera.position).normalize().multiplyScalar(-distance);\n          this.cameraPosition(newCameraPosition, center, transitionDuration);\n        }\n      }\n\n      return this;\n    },\n    getBbox: function getBbox(state) {\n      var objFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var box = new three.Box3(new three.Vector3(0, 0, 0), new three.Vector3(0, 0, 0));\n      var objs = state.objects.filter(objFilter);\n      if (!objs.length) return null;\n      objs.forEach(function (obj) {\n        return box.expandByObject(obj);\n      }); // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [box.min[c], box.max[c]]);\n      })));\n    },\n    getScreenCoords: function getScreenCoords(state, x, y, z) {\n      var vec = new three.Vector3(x, y, z);\n      vec.project(this.camera()); // project to the camera plane\n\n      return {\n        // align relative pos to canvas dimensions\n        x: (vec.x + 1) * state.width / 2,\n        y: -(vec.y - 1) * state.height / 2\n      };\n    },\n    getSceneCoords: function getSceneCoords(state, screenX, screenY) {\n      var distance = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var relCoords = new three.Vector2(screenX / state.width * 2 - 1, -(screenY / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.setFromCamera(relCoords, state.camera);\n      return Object.assign({}, raycaster.ray.at(distance, new three.Vector3()));\n    },\n    intersectingObjects: function intersectingObjects(state, x, y) {\n      var relCoords = new three.Vector2(x / state.width * 2 - 1, -(y / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.params.Line.threshold = state.lineHoverPrecision; // set linePrecision\n\n      raycaster.setFromCamera(relCoords, state.camera);\n      return raycaster.intersectObjects(state.objects, true);\n    },\n    renderer: function renderer(state) {\n      return state.renderer;\n    },\n    scene: function scene(state) {\n      return state.scene;\n    },\n    camera: function camera(state) {\n      return state.camera;\n    },\n    postProcessingComposer: function postProcessingComposer(state) {\n      return state.postProcessingComposer;\n    },\n    controls: function controls(state) {\n      return state.controls;\n    },\n    tbControls: function tbControls(state) {\n      return state.controls;\n    } // to be deprecated\n\n  },\n  stateInit: function stateInit() {\n    return {\n      scene: new three.Scene(),\n      camera: new three.PerspectiveCamera(),\n      clock: new three.Clock()\n    };\n  },\n  init: function init(domNode, state) {\n    var _ref4 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n        _ref4$controlType = _ref4.controlType,\n        controlType = _ref4$controlType === void 0 ? 'trackball' : _ref4$controlType,\n        _ref4$rendererConfig = _ref4.rendererConfig,\n        rendererConfig = _ref4$rendererConfig === void 0 ? {} : _ref4$rendererConfig,\n        _ref4$extraRenderers = _ref4.extraRenderers,\n        extraRenderers = _ref4$extraRenderers === void 0 ? [] : _ref4$extraRenderers,\n        _ref4$waitForLoadComp = _ref4.waitForLoadComplete,\n        waitForLoadComplete = _ref4$waitForLoadComp === void 0 ? true : _ref4$waitForLoadComp;\n\n    // Wipe DOM\n    domNode.innerHTML = ''; // Add relative container\n\n    domNode.appendChild(state.container = document.createElement('div'));\n    state.container.className = 'scene-container';\n    state.container.style.position = 'relative'; // Add nav info section\n\n    state.container.appendChild(state.navInfo = document.createElement('div'));\n    state.navInfo.className = 'scene-nav-info';\n    state.navInfo.textContent = {\n      orbit: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      trackball: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      fly: 'WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw'\n    }[controlType] || '';\n    state.navInfo.style.display = state.showNavInfo ? null : 'none'; // Setup tooltip\n\n    state.toolTipElem = document.createElement('div');\n    state.toolTipElem.classList.add('scene-tooltip');\n    state.container.appendChild(state.toolTipElem); // Capture pointer coords on move or touchstart\n\n    state.pointerPos = new three.Vector2();\n    state.pointerPos.x = -2; // Initialize off canvas\n\n    state.pointerPos.y = -2;\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return state.container.addEventListener(evType, function (ev) {\n        // track click state\n        evType === 'pointerdown' && (state.isPointerPressed = true); // detect point drag\n\n        !state.isPointerDragging && ev.type === 'pointermove' && (ev.pressure > 0 || state.isPointerPressed) // ev.pressure always 0 on Safari, so we used the isPointerPressed tracker\n        && (ev.pointerType !== 'touch' || ev.movementX === undefined || [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > 1;\n        })) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true);\n\n        if (state.enablePointerInteraction) {\n          // update the pointer pos\n          var offset = getOffset(state.container);\n          state.pointerPos.x = ev.pageX - offset.left;\n          state.pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n          state.toolTipElem.style.top = \"\".concat(state.pointerPos.y, \"px\");\n          state.toolTipElem.style.left = \"\".concat(state.pointerPos.x, \"px\");\n          state.toolTipElem.style.transform = \"translate(-\".concat(state.pointerPos.x / state.width * 100, \"%, 21px)\"); // adjust horizontal position to not exceed canvas boundaries\n        }\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    }); // Handle click events on objs\n\n    state.container.addEventListener('pointerup', function (ev) {\n      state.isPointerPressed = false;\n\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        if (!state.clickAfterDrag) return; // don't trigger onClick after pointer drag (camera motion via controls)\n      }\n\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // left-click\n          state.onClick(state.hoverObj || null, ev, state.intersectionPoint); // trigger background clicks with null\n        }\n\n        if (ev.button === 2 && state.onRightClick) {\n          // right-click\n          state.onRightClick(state.hoverObj || null, ev, state.intersectionPoint);\n        }\n      });\n    }, {\n      passive: true,\n      capture: true\n    }); // use capture phase to prevent propagation blocking from controls (specifically for fly)\n\n    state.container.addEventListener('contextmenu', function (ev) {\n      if (state.onRightClick) ev.preventDefault(); // prevent default contextmenu behavior and allow pointerup to fire instead\n    }); // Setup renderer, camera and controls\n\n    state.renderer = new three.WebGLRenderer(Object.assign({\n      antialias: true,\n      alpha: true\n    }, rendererConfig));\n    state.renderer.setPixelRatio(Math.min(2, window.devicePixelRatio)); // clamp device pixel ratio\n\n    state.container.appendChild(state.renderer.domElement); // Setup extra renderers\n\n    state.extraRenderers = extraRenderers;\n    state.extraRenderers.forEach(function (r) {\n      // overlay them on top of main renderer\n      r.domElement.style.position = 'absolute';\n      r.domElement.style.top = '0px';\n      r.domElement.style.pointerEvents = 'none';\n      state.container.appendChild(r.domElement);\n    }); // configure post-processing composer\n\n    state.postProcessingComposer = new EffectComposer(state.renderer);\n    state.postProcessingComposer.addPass(new RenderPass(state.scene, state.camera)); // render scene as first pass\n    // configure controls\n\n    state.controls = new {\n      trackball: TrackballControls,\n      orbit: OrbitControls,\n      fly: FlyControls\n    }[controlType](state.camera, state.renderer.domElement);\n\n    if (controlType === 'fly') {\n      state.controls.movementSpeed = 300;\n      state.controls.rollSpeed = Math.PI / 6;\n      state.controls.dragToLook = true;\n    }\n\n    if (controlType === 'trackball' || controlType === 'orbit') {\n      state.controls.minDistance = 0.1;\n      state.controls.maxDistance = state.skyRadius;\n      state.controls.addEventListener('start', function () {\n        state.isPointerPressed = true; // trackball controls blocks pointerdown events, so we have to track it (also) here\n\n        state.controlsEngaged = true;\n      });\n      state.controls.addEventListener('change', function () {\n        if (state.controlsEngaged) {\n          state.controlsDragging = true;\n        }\n      });\n      state.controls.addEventListener('end', function () {\n        state.controlsEngaged = false;\n        state.controlsDragging = false;\n      });\n    }\n\n    [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n      return r.setSize(state.width, state.height);\n    });\n    state.camera.aspect = state.width / state.height;\n    state.camera.updateProjectionMatrix();\n    state.camera.position.z = 1000; // add sky\n\n    state.scene.add(state.skysphere = new three.Mesh());\n    state.skysphere.visible = false;\n    state.loadComplete = state.scene.visible = !waitForLoadComplete;\n    window.scene = state.scene;\n  },\n  update: function update(state, changedProps) {\n    // resize canvas\n    if (state.width && state.height && (changedProps.hasOwnProperty('width') || changedProps.hasOwnProperty('height'))) {\n      state.container.style.width = state.width;\n      state.container.style.height = state.height;\n      [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n        return r.setSize(state.width, state.height);\n      });\n      state.camera.aspect = state.width / state.height;\n      state.camera.updateProjectionMatrix();\n    }\n\n    if (changedProps.hasOwnProperty('skyRadius') && state.skyRadius) {\n      state.controls.hasOwnProperty('maxDistance') && changedProps.skyRadius && (state.controls.maxDistance = state.skyRadius);\n      state.camera.far = state.skyRadius * 2.5;\n      state.camera.updateProjectionMatrix();\n      state.skysphere.geometry = new three.SphereGeometry(state.skyRadius);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundColor')) {\n      var alpha = parseToRgb(state.backgroundColor).alpha;\n      if (alpha === undefined) alpha = 1;\n      state.renderer.setClearColor(new three.Color(opacify(1, state.backgroundColor)), alpha);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundImageUrl')) {\n      if (!state.backgroundImageUrl) {\n        state.skysphere.visible = false;\n        state.skysphere.material.map = null;\n        !state.loadComplete && finishLoad();\n      } else {\n        new three.TextureLoader().load(state.backgroundImageUrl, function (texture) {\n          state.skysphere.material = new three.MeshBasicMaterial({\n            map: texture,\n            side: three.BackSide\n          });\n          state.skysphere.visible = true; // triggered when background image finishes loading (asynchronously to allow 1 frame to load texture)\n\n          state.onBackgroundImageLoaded && setTimeout(state.onBackgroundImageLoaded);\n          !state.loadComplete && finishLoad();\n        });\n      }\n    }\n\n    changedProps.hasOwnProperty('showNavInfo') && (state.navInfo.style.display = state.showNavInfo ? null : 'none');\n\n    if (changedProps.hasOwnProperty('objects')) {\n      (changedProps.objects || []).forEach(function (obj) {\n        return state.scene.remove(obj);\n      }); // Clear the place\n\n      state.objects.forEach(function (obj) {\n        return state.scene.add(obj);\n      }); // Add to scene\n    } //\n\n\n    function finishLoad() {\n      state.loadComplete = state.scene.visible = true;\n    }\n  }\n});\n\nexport default threeRenderObjects;\n"]},"metadata":{},"sourceType":"module"}