{"ast":null,"code":"//\n// (c) 2018 Philippe Riviere\n//\n// https://github.com/Fil/\n//\n// This software is distributed under the terms of the MIT License\nimport { extent } from \"d3-array\";\nimport { geoCentroid, geoDistance } from \"d3-geo\";\nimport { geoDelaunay, excess } from \"./delaunay.js\";\nimport { tau } from \"./math.js\";\nexport function geoVoronoi(data) {\n  const v = function (data) {\n    v.delaunay = null;\n    v._data = data;\n\n    if (typeof v._data === \"object\" && v._data.type === \"FeatureCollection\") {\n      v._data = v._data.features;\n    }\n\n    if (typeof v._data === \"object\") {\n      const temp = v._data.map(d => [v._vx(d), v._vy(d), d]).filter(d => isFinite(d[0] + d[1]));\n\n      v.points = temp.map(d => [d[0], d[1]]);\n      v.valid = temp.map(d => d[2]);\n      v.delaunay = geoDelaunay(v.points);\n    }\n\n    return v;\n  };\n\n  v._vx = function (d) {\n    if (typeof d == \"object\" && \"type\" in d) {\n      return geoCentroid(d)[0];\n    }\n\n    if (0 in d) return d[0];\n  };\n\n  v._vy = function (d) {\n    if (typeof d == \"object\" && \"type\" in d) {\n      return geoCentroid(d)[1];\n    }\n\n    if (1 in d) return d[1];\n  };\n\n  v.x = function (f) {\n    if (!f) return v._vx;\n    v._vx = f;\n    return v;\n  };\n\n  v.y = function (f) {\n    if (!f) return v._vy;\n    v._vy = f;\n    return v;\n  };\n\n  v.polygons = function (data) {\n    if (data !== undefined) {\n      v(data);\n    }\n\n    if (!v.delaunay) return false;\n    const coll = {\n      type: \"FeatureCollection\",\n      features: []\n    };\n    if (v.valid.length === 0) return coll;\n    v.delaunay.polygons.forEach((poly, i) => coll.features.push({\n      type: \"Feature\",\n      geometry: !poly ? null : {\n        type: \"Polygon\",\n        coordinates: [[...poly, poly[0]].map(i => v.delaunay.centers[i])]\n      },\n      properties: {\n        site: v.valid[i],\n        sitecoordinates: v.points[i],\n        neighbours: v.delaunay.neighbors[i] // not part of the public API\n\n      }\n    }));\n    if (v.valid.length === 1) coll.features.push({\n      type: \"Feature\",\n      geometry: {\n        type: \"Sphere\"\n      },\n      properties: {\n        site: v.valid[0],\n        sitecoordinates: v.points[0],\n        neighbours: []\n      }\n    });\n    return coll;\n  };\n\n  v.triangles = function (data) {\n    if (data !== undefined) {\n      v(data);\n    }\n\n    if (!v.delaunay) return false;\n    return {\n      type: \"FeatureCollection\",\n      features: v.delaunay.triangles.map((tri, index) => {\n        tri = tri.map(i => v.points[i]);\n        tri.center = v.delaunay.centers[index];\n        return tri;\n      }).filter(tri => excess(tri) > 0).map(tri => ({\n        type: \"Feature\",\n        properties: {\n          circumcenter: tri.center\n        },\n        geometry: {\n          type: \"Polygon\",\n          coordinates: [[...tri, tri[0]]]\n        }\n      }))\n    };\n  };\n\n  v.links = function (data) {\n    if (data !== undefined) {\n      v(data);\n    }\n\n    if (!v.delaunay) return false;\n\n    const _distances = v.delaunay.edges.map(e => geoDistance(v.points[e[0]], v.points[e[1]])),\n          _urquart = v.delaunay.urquhart(_distances);\n\n    return {\n      type: \"FeatureCollection\",\n      features: v.delaunay.edges.map((e, i) => ({\n        type: \"Feature\",\n        properties: {\n          source: v.valid[e[0]],\n          target: v.valid[e[1]],\n          length: _distances[i],\n          urquhart: !!_urquart[i]\n        },\n        geometry: {\n          type: \"LineString\",\n          coordinates: [v.points[e[0]], v.points[e[1]]]\n        }\n      }))\n    };\n  };\n\n  v.mesh = function (data) {\n    if (data !== undefined) {\n      v(data);\n    }\n\n    if (!v.delaunay) return false;\n    return {\n      type: \"MultiLineString\",\n      coordinates: v.delaunay.edges.map(e => [v.points[e[0]], v.points[e[1]]])\n    };\n  };\n\n  v.cellMesh = function (data) {\n    if (data !== undefined) {\n      v(data);\n    }\n\n    if (!v.delaunay) return false;\n    const {\n      centers,\n      polygons\n    } = v.delaunay;\n    const coordinates = [];\n\n    for (const p of polygons) {\n      if (!p) continue;\n\n      for (let n = p.length, p0 = p[n - 1], p1 = p[0], i = 0; i < n; p0 = p1, p1 = p[++i]) {\n        if (p1 > p0) {\n          coordinates.push([centers[p0], centers[p1]]);\n        }\n      }\n    }\n\n    return {\n      type: \"MultiLineString\",\n      coordinates\n    };\n  };\n\n  v._found = undefined;\n\n  v.find = function (x, y, radius) {\n    v._found = v.delaunay.find(x, y, v._found);\n    if (!radius || geoDistance([x, y], v.points[v._found]) < radius) return v._found;\n  };\n\n  v.hull = function (data) {\n    if (data !== undefined) {\n      v(data);\n    }\n\n    const hull = v.delaunay.hull,\n          points = v.points;\n    return hull.length === 0 ? null : {\n      type: \"Polygon\",\n      coordinates: [[...hull.map(i => points[i]), points[hull[0]]]]\n    };\n  };\n\n  return data ? v(data) : v;\n}","map":{"version":3,"sources":["/Users/lechuanwang/node_modules/d3-geo-voronoi/src/voronoi.js"],"names":["extent","geoCentroid","geoDistance","geoDelaunay","excess","tau","geoVoronoi","data","v","delaunay","_data","type","features","temp","map","d","_vx","_vy","filter","isFinite","points","valid","x","f","y","polygons","undefined","coll","length","forEach","poly","i","push","geometry","coordinates","centers","properties","site","sitecoordinates","neighbours","neighbors","triangles","tri","index","center","circumcenter","links","_distances","edges","e","_urquart","urquhart","source","target","mesh","cellMesh","p","n","p0","p1","_found","find","radius","hull"],"mappings":"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","sourcesContent":["//\n// (c) 2018 Philippe Riviere\n//\n// https://github.com/Fil/\n//\n// This software is distributed under the terms of the MIT License\n\nimport { extent } from \"d3-array\";\nimport { geoCentroid, geoDistance } from \"d3-geo\";\nimport { geoDelaunay, excess } from \"./delaunay.js\";\nimport { tau } from \"./math.js\";\n\nexport function geoVoronoi(data) {\n  const v = function(data) {\n    v.delaunay = null;\n    v._data = data;\n\n    if (typeof v._data === \"object\" && v._data.type === \"FeatureCollection\") {\n      v._data = v._data.features;\n    }\n    if (typeof v._data === \"object\") {\n      const temp = v._data\n        .map(d => [v._vx(d), v._vy(d), d])\n        .filter(d => isFinite(d[0] + d[1]));\n      v.points = temp.map(d => [d[0], d[1]]);\n      v.valid = temp.map(d => d[2]);\n      v.delaunay = geoDelaunay(v.points);\n    }\n    return v;\n  };\n\n  v._vx = function(d) {\n    if (typeof d == \"object\" && \"type\" in d) {\n      return geoCentroid(d)[0];\n    }\n    if (0 in d) return d[0];\n  };\n  v._vy = function(d) {\n    if (typeof d == \"object\" && \"type\" in d) {\n      return geoCentroid(d)[1];\n    }\n    if (1 in d) return d[1];\n  };\n\n  v.x = function(f) {\n    if (!f) return v._vx;\n    v._vx = f;\n    return v;\n  };\n  v.y = function(f) {\n    if (!f) return v._vy;\n    v._vy = f;\n    return v;\n  };\n\n  v.polygons = function(data) {\n    if (data !== undefined) {\n      v(data);\n    }\n\n    if (!v.delaunay) return false;\n    const coll = {\n      type: \"FeatureCollection\",\n      features: []\n    };\n    if (v.valid.length === 0) return coll;\n    v.delaunay.polygons.forEach((poly, i) =>\n      coll.features.push({\n        type: \"Feature\",\n        geometry: !poly\n          ? null\n          : {\n              type: \"Polygon\",\n              coordinates: [[...poly, poly[0]].map(i => v.delaunay.centers[i])]\n            },\n        properties: {\n          site: v.valid[i],\n          sitecoordinates: v.points[i],\n          neighbours: v.delaunay.neighbors[i] // not part of the public API\n        }\n      })\n    );\n    if (v.valid.length === 1)\n      coll.features.push({\n        type: \"Feature\",\n        geometry: { type: \"Sphere\" },\n        properties: {\n          site: v.valid[0],\n          sitecoordinates: v.points[0],\n          neighbours: []\n        }\n      });\n    return coll;\n  };\n\n  v.triangles = function(data) {\n    if (data !== undefined) {\n      v(data);\n    }\n    if (!v.delaunay) return false;\n\n    return {\n      type: \"FeatureCollection\",\n      features: v.delaunay.triangles\n        .map((tri, index) => {\n          tri = tri.map(i => v.points[i]);\n          tri.center = v.delaunay.centers[index];\n          return tri;\n        })\n        .filter(tri => excess(tri) > 0)\n        .map(tri => ({\n          type: \"Feature\",\n          properties: {\n            circumcenter: tri.center\n          },\n          geometry: {\n            type: \"Polygon\",\n            coordinates: [[...tri, tri[0]]]\n          }\n        }))\n    };\n  };\n\n  v.links = function(data) {\n    if (data !== undefined) {\n      v(data);\n    }\n    if (!v.delaunay) return false;\n    const _distances = v.delaunay.edges.map(e =>\n        geoDistance(v.points[e[0]], v.points[e[1]])\n      ),\n      _urquart = v.delaunay.urquhart(_distances);\n    return {\n      type: \"FeatureCollection\",\n      features: v.delaunay.edges.map((e, i) => ({\n        type: \"Feature\",\n        properties: {\n          source: v.valid[e[0]],\n          target: v.valid[e[1]],\n          length: _distances[i],\n          urquhart: !!_urquart[i]\n        },\n        geometry: {\n          type: \"LineString\",\n          coordinates: [v.points[e[0]], v.points[e[1]]]\n        }\n      }))\n    };\n  };\n\n  v.mesh = function(data) {\n    if (data !== undefined) {\n      v(data);\n    }\n    if (!v.delaunay) return false;\n    return {\n      type: \"MultiLineString\",\n      coordinates: v.delaunay.edges.map(e => [v.points[e[0]], v.points[e[1]]])\n    };\n  };\n\n  v.cellMesh = function(data) {\n    if (data !== undefined) {\n      v(data);\n    }\n    if (!v.delaunay) return false;\n    const { centers, polygons } = v.delaunay;\n    const coordinates = [];\n    for (const p of polygons) {\n      if (!p) continue;\n      for (\n        let n = p.length, p0 = p[n - 1], p1 = p[0], i = 0;\n        i < n;\n        p0 = p1, p1 = p[++i]\n      ) {\n        if (p1 > p0) {\n          coordinates.push([centers[p0], centers[p1]]);\n        }\n      }\n    }\n    return {\n      type: \"MultiLineString\",\n      coordinates\n    };\n  };\n\n  v._found = undefined;\n  v.find = function(x, y, radius) {\n    v._found = v.delaunay.find(x, y, v._found);\n    if (!radius || geoDistance([x, y], v.points[v._found]) < radius)\n      return v._found;\n  };\n\n  v.hull = function(data) {\n    if (data !== undefined) {\n      v(data);\n    }\n    const hull = v.delaunay.hull,\n      points = v.points;\n    return hull.length === 0\n      ? null\n      : {\n          type: \"Polygon\",\n          coordinates: [[...hull.map(i => points[i]), points[hull[0]]]]\n        };\n  };\n\n  return data ? v(data) : v;\n}\n"]},"metadata":{},"sourceType":"module"}