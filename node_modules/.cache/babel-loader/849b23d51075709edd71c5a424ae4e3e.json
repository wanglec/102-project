{"ast":null,"code":"import { BufferGeometry, Float32BufferAttribute } from 'three';\nimport earcut from 'earcut';\nimport { geoDistance, geoInterpolate } from 'd3-geo';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (e) {\n          throw e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = it.call(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (e) {\n      didErr = true;\n      err = e;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nvar interpolateLine = function interpolateLine() {\n  var lineCoords = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var maxDegDistance = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n  var result = [];\n  var prevPnt = null;\n  lineCoords.forEach(function (pnt) {\n    if (prevPnt) {\n      var dist = geoDistance(pnt, prevPnt) * 180 / Math.PI;\n\n      if (dist > maxDegDistance) {\n        var interpol = geoInterpolate(prevPnt, pnt);\n        var tStep = 1 / Math.ceil(dist / maxDegDistance);\n        var t = tStep;\n\n        while (t < 1) {\n          result.push(interpol(t));\n          t += tStep;\n        }\n      }\n    }\n\n    result.push(prevPnt = pnt);\n  });\n  return result;\n};\n\nvar THREE = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  BufferGeometry: BufferGeometry,\n  Float32BufferAttribute: Float32BufferAttribute\n};\nvar setAttributeFn = new THREE.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\n\nvar GeoJsonGeometry = /*#__PURE__*/function (_THREE$BufferGeometry) {\n  _inherits(GeoJsonGeometry, _THREE$BufferGeometry);\n\n  var _super = _createSuper(GeoJsonGeometry);\n\n  function GeoJsonGeometry(geoJson) {\n    var _this;\n\n    var radius = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    var resolution = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;\n\n    _classCallCheck(this, GeoJsonGeometry);\n\n    _this = _super.call(this);\n    _this.type = 'GeoJsonGeometry';\n    _this.parameters = {\n      geoJson: geoJson,\n      radius: radius,\n      resolution: resolution\n    }; // process various geometry types\n\n    var groups = ({\n      Point: genPoint,\n      MultiPoint: genMultiPoint,\n      LineString: genLineString,\n      MultiLineString: genMultiLineString,\n      Polygon: genPolygon,\n      MultiPolygon: genMultiPolygon\n    }[geoJson.type] || function () {\n      return [];\n    })(geoJson.coordinates, radius); // concat groups\n\n\n    var indices = [],\n        vertices = [];\n    var groupCnt = 0;\n    groups.forEach(function (newG) {\n      var prevIndCnt = indices.length;\n      concatGroup({\n        indices: indices,\n        vertices: vertices\n      }, newG);\n\n      _this.addGroup(prevIndCnt, indices.length - prevIndCnt, groupCnt++);\n    }); // build geometry\n\n    indices.length && _this.setIndex(indices);\n    vertices.length && _this[setAttributeFn]('position', new THREE.Float32BufferAttribute(vertices, 3)); //\n\n    function genPoint(coords, r) {\n      var vertices = polar2Cartesian(coords[1], coords[0], r);\n      var indices = [];\n      return [{\n        vertices: vertices,\n        indices: indices\n      }];\n    }\n\n    function genMultiPoint(coords, r) {\n      var result = {\n        vertices: [],\n        indices: []\n      };\n      coords.map(function (c) {\n        return genPoint(c, r);\n      }).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 1),\n            newPnt = _ref2[0];\n\n        concatGroup(result, newPnt);\n      });\n      return [result];\n    }\n\n    function genLineString(coords, r) {\n      var coords3d = interpolateLine(coords, resolution).map(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n            lng = _ref4[0],\n            lat = _ref4[1];\n\n        return polar2Cartesian(lat, lng, r);\n      });\n\n      var _earcut$flatten = earcut.flatten([coords3d]),\n          vertices = _earcut$flatten.vertices;\n\n      var numPoints = Math.round(vertices.length / 3);\n      var indices = [];\n\n      for (var vIdx = 1; vIdx < numPoints; vIdx++) {\n        indices.push(vIdx - 1, vIdx);\n      }\n\n      return [{\n        vertices: vertices,\n        indices: indices\n      }];\n    }\n\n    function genMultiLineString(coords, r) {\n      var result = {\n        vertices: [],\n        indices: []\n      };\n      coords.map(function (c) {\n        return genLineString(c, r);\n      }).forEach(function (_ref5) {\n        var _ref6 = _slicedToArray(_ref5, 1),\n            newLine = _ref6[0];\n\n        concatGroup(result, newLine);\n      });\n      return [result];\n    }\n\n    function genPolygon(coords, r) {\n      var coords3d = coords.map(function (coordsSegment) {\n        return interpolateLine(coordsSegment, resolution).map(function (_ref7) {\n          var _ref8 = _slicedToArray(_ref7, 2),\n              lng = _ref8[0],\n              lat = _ref8[1];\n\n          return polar2Cartesian(lat, lng, r);\n        });\n      }); // Each point generates 3 vertice items (x,y,z).\n\n      var _earcut$flatten2 = earcut.flatten(coords3d),\n          vertices = _earcut$flatten2.vertices,\n          holes = _earcut$flatten2.holes;\n\n      var firstHoleIdx = holes[0] || Infinity;\n      var outerVertices = vertices.slice(0, firstHoleIdx);\n      var holeVertices = vertices.slice(firstHoleIdx);\n      var holesIdx = new Set(holes);\n      var numPoints = Math.round(vertices.length / 3);\n      var outerIndices = [],\n          holeIndices = [];\n\n      for (var vIdx = 1; vIdx < numPoints; vIdx++) {\n        if (!holesIdx.has(vIdx)) {\n          if (vIdx < firstHoleIdx) {\n            outerIndices.push(vIdx - 1, vIdx);\n          } else {\n            holeIndices.push(vIdx - 1 - firstHoleIdx, vIdx - firstHoleIdx);\n          }\n        }\n      }\n\n      var groups = [{\n        indices: outerIndices,\n        vertices: outerVertices\n      }];\n\n      if (holes.length) {\n        groups.push({\n          indices: holeIndices,\n          vertices: holeVertices\n        });\n      }\n\n      return groups;\n    }\n\n    function genMultiPolygon(coords, r) {\n      var outer = {\n        vertices: [],\n        indices: []\n      };\n      var holes = {\n        vertices: [],\n        indices: []\n      };\n      coords.map(function (c) {\n        return genPolygon(c, r);\n      }).forEach(function (_ref9) {\n        var _ref10 = _slicedToArray(_ref9, 2),\n            newOuter = _ref10[0],\n            newHoles = _ref10[1];\n\n        concatGroup(outer, newOuter);\n        newHoles && concatGroup(holes, newHoles);\n      });\n      var groups = [outer];\n      holes.vertices.length && groups.push(holes);\n      return groups;\n    }\n\n    return _this;\n  }\n\n  return GeoJsonGeometry;\n}(THREE.BufferGeometry); //\n\n\nfunction concatGroup(main, extra) {\n  var prevVertCnt = Math.round(main.vertices.length / 3);\n  concatArr(main.vertices, extra.vertices);\n  concatArr(main.indices, extra.indices.map(function (ind) {\n    return ind + prevVertCnt;\n  }));\n}\n\nfunction concatArr(target, src) {\n  var _iterator = _createForOfIteratorHelper(src),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var e = _step.value;\n      target.push(e);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n}\n\nfunction polar2Cartesian(lat, lng) {\n  var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var phi = (90 - lat) * Math.PI / 180;\n  var theta = (90 - lng) * Math.PI / 180;\n  return [r * Math.sin(phi) * Math.cos(theta), // x\n  r * Math.cos(phi), // y\n  r * Math.sin(phi) * Math.sin(theta) // z\n  ];\n}\n\nexport { GeoJsonGeometry };","map":{"version":3,"sources":["/Users/lechuanwang/Documents/2021 spring/dsc106/project/dsc102/102-project/node_modules/three-geojson-geometry/dist/three-geojson-geometry.module.js"],"names":["BufferGeometry","Float32BufferAttribute","earcut","geoDistance","geoInterpolate","_classCallCheck","instance","Constructor","TypeError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","writable","configurable","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","call","e","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","arguments","apply","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","Array","isArray","_i","Symbol","iterator","_arr","_n","_d","_s","_e","next","done","push","length","err","minLen","_arrayLikeToArray","n","toString","slice","name","from","test","len","arr2","_createForOfIteratorHelper","allowArrayLike","it","F","s","f","normalCompletion","didErr","step","return","interpolateLine","lineCoords","undefined","maxDegDistance","prevPnt","forEach","pnt","dist","Math","PI","interpol","tStep","ceil","t","THREE","window","setAttributeFn","setAttribute","GeoJsonGeometry","_THREE$BufferGeometry","_super","geoJson","_this","radius","resolution","type","parameters","groups","Point","genPoint","MultiPoint","genMultiPoint","LineString","genLineString","MultiLineString","genMultiLineString","Polygon","genPolygon","MultiPolygon","genMultiPolygon","coordinates","indices","vertices","groupCnt","newG","prevIndCnt","concatGroup","addGroup","setIndex","coords","r","polar2Cartesian","map","c","_ref","_ref2","newPnt","coords3d","_ref3","_ref4","lng","lat","_earcut$flatten","flatten","numPoints","round","vIdx","_ref5","_ref6","newLine","coordsSegment","_ref7","_ref8","_earcut$flatten2","holes","firstHoleIdx","Infinity","outerVertices","holeVertices","holesIdx","Set","outerIndices","holeIndices","has","outer","_ref9","_ref10","newOuter","newHoles","main","extra","prevVertCnt","concatArr","ind","target","src","_iterator","_step","phi","theta","sin","cos"],"mappings":"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","sourcesContent":["import { BufferGeometry, Float32BufferAttribute } from 'three';\nimport earcut from 'earcut';\nimport { geoDistance, geoInterpolate } from 'd3-geo';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (e) {\n          throw e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = it.call(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (e) {\n      didErr = true;\n      err = e;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nvar interpolateLine = function interpolateLine() {\n  var lineCoords = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var maxDegDistance = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n  var result = [];\n  var prevPnt = null;\n  lineCoords.forEach(function (pnt) {\n    if (prevPnt) {\n      var dist = geoDistance(pnt, prevPnt) * 180 / Math.PI;\n\n      if (dist > maxDegDistance) {\n        var interpol = geoInterpolate(prevPnt, pnt);\n        var tStep = 1 / Math.ceil(dist / maxDegDistance);\n        var t = tStep;\n\n        while (t < 1) {\n          result.push(interpol(t));\n          t += tStep;\n        }\n      }\n    }\n\n    result.push(prevPnt = pnt);\n  });\n  return result;\n};\n\nvar THREE = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  BufferGeometry: BufferGeometry,\n  Float32BufferAttribute: Float32BufferAttribute\n};\n\nvar setAttributeFn = new THREE.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\n\nvar GeoJsonGeometry = /*#__PURE__*/function (_THREE$BufferGeometry) {\n  _inherits(GeoJsonGeometry, _THREE$BufferGeometry);\n\n  var _super = _createSuper(GeoJsonGeometry);\n\n  function GeoJsonGeometry(geoJson) {\n    var _this;\n\n    var radius = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    var resolution = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;\n\n    _classCallCheck(this, GeoJsonGeometry);\n\n    _this = _super.call(this);\n    _this.type = 'GeoJsonGeometry';\n    _this.parameters = {\n      geoJson: geoJson,\n      radius: radius,\n      resolution: resolution\n    }; // process various geometry types\n\n    var groups = ({\n      Point: genPoint,\n      MultiPoint: genMultiPoint,\n      LineString: genLineString,\n      MultiLineString: genMultiLineString,\n      Polygon: genPolygon,\n      MultiPolygon: genMultiPolygon\n    }[geoJson.type] || function () {\n      return [];\n    })(geoJson.coordinates, radius); // concat groups\n\n\n    var indices = [],\n        vertices = [];\n    var groupCnt = 0;\n    groups.forEach(function (newG) {\n      var prevIndCnt = indices.length;\n      concatGroup({\n        indices: indices,\n        vertices: vertices\n      }, newG);\n\n      _this.addGroup(prevIndCnt, indices.length - prevIndCnt, groupCnt++);\n    }); // build geometry\n\n    indices.length && _this.setIndex(indices);\n    vertices.length && _this[setAttributeFn]('position', new THREE.Float32BufferAttribute(vertices, 3)); //\n\n    function genPoint(coords, r) {\n      var vertices = polar2Cartesian(coords[1], coords[0], r);\n      var indices = [];\n      return [{\n        vertices: vertices,\n        indices: indices\n      }];\n    }\n\n    function genMultiPoint(coords, r) {\n      var result = {\n        vertices: [],\n        indices: []\n      };\n      coords.map(function (c) {\n        return genPoint(c, r);\n      }).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 1),\n            newPnt = _ref2[0];\n\n        concatGroup(result, newPnt);\n      });\n      return [result];\n    }\n\n    function genLineString(coords, r) {\n      var coords3d = interpolateLine(coords, resolution).map(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n            lng = _ref4[0],\n            lat = _ref4[1];\n\n        return polar2Cartesian(lat, lng, r);\n      });\n\n      var _earcut$flatten = earcut.flatten([coords3d]),\n          vertices = _earcut$flatten.vertices;\n\n      var numPoints = Math.round(vertices.length / 3);\n      var indices = [];\n\n      for (var vIdx = 1; vIdx < numPoints; vIdx++) {\n        indices.push(vIdx - 1, vIdx);\n      }\n\n      return [{\n        vertices: vertices,\n        indices: indices\n      }];\n    }\n\n    function genMultiLineString(coords, r) {\n      var result = {\n        vertices: [],\n        indices: []\n      };\n      coords.map(function (c) {\n        return genLineString(c, r);\n      }).forEach(function (_ref5) {\n        var _ref6 = _slicedToArray(_ref5, 1),\n            newLine = _ref6[0];\n\n        concatGroup(result, newLine);\n      });\n      return [result];\n    }\n\n    function genPolygon(coords, r) {\n      var coords3d = coords.map(function (coordsSegment) {\n        return interpolateLine(coordsSegment, resolution).map(function (_ref7) {\n          var _ref8 = _slicedToArray(_ref7, 2),\n              lng = _ref8[0],\n              lat = _ref8[1];\n\n          return polar2Cartesian(lat, lng, r);\n        });\n      }); // Each point generates 3 vertice items (x,y,z).\n\n      var _earcut$flatten2 = earcut.flatten(coords3d),\n          vertices = _earcut$flatten2.vertices,\n          holes = _earcut$flatten2.holes;\n\n      var firstHoleIdx = holes[0] || Infinity;\n      var outerVertices = vertices.slice(0, firstHoleIdx);\n      var holeVertices = vertices.slice(firstHoleIdx);\n      var holesIdx = new Set(holes);\n      var numPoints = Math.round(vertices.length / 3);\n      var outerIndices = [],\n          holeIndices = [];\n\n      for (var vIdx = 1; vIdx < numPoints; vIdx++) {\n        if (!holesIdx.has(vIdx)) {\n          if (vIdx < firstHoleIdx) {\n            outerIndices.push(vIdx - 1, vIdx);\n          } else {\n            holeIndices.push(vIdx - 1 - firstHoleIdx, vIdx - firstHoleIdx);\n          }\n        }\n      }\n\n      var groups = [{\n        indices: outerIndices,\n        vertices: outerVertices\n      }];\n\n      if (holes.length) {\n        groups.push({\n          indices: holeIndices,\n          vertices: holeVertices\n        });\n      }\n\n      return groups;\n    }\n\n    function genMultiPolygon(coords, r) {\n      var outer = {\n        vertices: [],\n        indices: []\n      };\n      var holes = {\n        vertices: [],\n        indices: []\n      };\n      coords.map(function (c) {\n        return genPolygon(c, r);\n      }).forEach(function (_ref9) {\n        var _ref10 = _slicedToArray(_ref9, 2),\n            newOuter = _ref10[0],\n            newHoles = _ref10[1];\n\n        concatGroup(outer, newOuter);\n        newHoles && concatGroup(holes, newHoles);\n      });\n      var groups = [outer];\n      holes.vertices.length && groups.push(holes);\n      return groups;\n    }\n\n    return _this;\n  }\n\n  return GeoJsonGeometry;\n}(THREE.BufferGeometry); //\n\n\nfunction concatGroup(main, extra) {\n  var prevVertCnt = Math.round(main.vertices.length / 3);\n  concatArr(main.vertices, extra.vertices);\n  concatArr(main.indices, extra.indices.map(function (ind) {\n    return ind + prevVertCnt;\n  }));\n}\n\nfunction concatArr(target, src) {\n  var _iterator = _createForOfIteratorHelper(src),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var e = _step.value;\n      target.push(e);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n}\n\nfunction polar2Cartesian(lat, lng) {\n  var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var phi = (90 - lat) * Math.PI / 180;\n  var theta = (90 - lng) * Math.PI / 180;\n  return [r * Math.sin(phi) * Math.cos(theta), // x\n  r * Math.cos(phi), // y\n  r * Math.sin(phi) * Math.sin(theta) // z\n  ];\n}\n\nexport { GeoJsonGeometry };\n"]},"metadata":{},"sourceType":"module"}